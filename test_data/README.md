# 测试数据集说明

本文件夹包含用于测试"城市通讯系统"的各种 CSV 测试数据。所有文件均可在"地图叠加"页面上传进行测试。

## 📊 测试数据集列表

### 1. `test_basic_5cities.csv` ⭐ **基础测试集（推荐首先使用）**

**特点**：
- 包含 5 个城市（北京、上海、广州、成都、西安）
- 包含 6 条边
- 混合格式：城市表 + 边表在同一文件
- 完全连通（所有城市在同一连通分量）

**用途**：快速验证拓扑加载、路由查询、MST 计算

**期望结果**：
```
POST /topology 返回: cities: 5, edges: 6, mst_edges: 4
路由查询示例:
  北京 -> 成都: 北京 -> 上海 -> 成都 (2 跳)
  上海 -> 西安: 上海 -> 北京 -> 西安 (2 跳)
```

---

### 2. `test_medium_10cities.csv` **中等规模测试集**

**特点**：
- 包含 10 个城市（北京、上海、广州、成都、西安、深圳、杭州、重庆、南京、武汉）
- 包含 15 条边
- 混合格式
- 完全连通

**用途**：测试中等规模网络的性能和正确性

**期望结果**：
```
POST /topology 返回: cities: 10, edges: 15, mst_edges: 9
```

---

### 3. `test_cities_only.csv` **仅城市表**

**特点**：
- 只包含城市坐标表（没有边表）
- 格式：纯 CSV，仅有 name,lng,lat 三列

**用途**：
- 测试"仅上传城市而不上传边"的场景
- 验证前端错误处理

**期望结果**：
```
页面显示: "已加载 5 个城市"
但无法显示拓扑（因为无边）
后续路由查询会返回 404（未找到路径）
```

---

### 4. `test_edges_only.csv` **仅边表**

**特点**：
- 只包含边表（没有城市坐标）
- 使用城市名作为边的端点

**用途**：
- 测试"先上传城市，后上传边"的工作流
- 验证边表与城市表的独立处理

**操作步骤**：
1. 先上传 `test_cities_pure.csv`（加载城市）
2. 再上传 `test_edges_only.csv`（加载边）
3. 验证是否正确合并

---

### 5. `test_cities_pure.csv` **纯城市表**

**特点**：
- 仅包含城市坐标，无边表
- 格式标准化，无任何边的相关信息

**用途**：
- 与 `test_edges_only.csv` 配合使用
- 测试"分步上传"工作流

---

### 6. `test_indexed_edges.csv` **索引编号边表**

**特点**：
- 城市用 1-based 索引表示（1,2,3,4,5）而非城市名
- 边表中的 u,v 为数字索引

**用途**：
- 验证系统是否支持"按索引"指定边
- 测试索引转换逻辑

**期望结果**：
```
1-based 索引会自动转换为 0-based
边应该被正确解析
```

---

### 7. `test_invalid_cities.csv` ❌ **包含无效城市名的测试**

**特点**：
- 城市表中有 5 个城市：北京、上海、广州、成都、西安
- 边表中引用了不存在的城市：杭州、南京、苏州
- 部分边无法匹配

**用途**：
- 测试错误提示的清晰性
- 验证前端如何处理"城市名不匹配"的情况

**期望结果**：
```
错误提示应该显示：
  "无法匹配的城市名: 杭州, 南京, 苏州。请确保城市表中有对应名称（区分大小写）。"
浏览器控制台会列出无法匹配的具体城市名
```

---

### 8. `test_disconnected.csv` **不连通的图**

**特点**：
- 包含 6 个城市
- 只有 3 条边，分为 3 个独立的连通分量：
  - (北京, 上海)
  - (成都, 西安)
  - (广州, 深圳)

**用途**：
- 测试"图不连通"的场景
- 验证路由查询在不连通时的行为

**期望结果**：
```
POST /topology 返回: cities: 6, edges: 3, mst_edges: 2
路由查询北京 -> 成都 会返回: 404 "未找到路径"
```

---

## 🧪 测试工作流

### 场景 1：完整流程测试（推荐）
```
1. 打开"地图叠加"页面
2. 上传 test_basic_5cities.csv
3. 验证页面显示"已加载 5 个城市"
4. 点击"计算最小生成树"，查看结果
5. 浏览器访问 http://localhost:8000/topology/status 确认后端已加载
6. 进入"城市通讯"页面
7. 选择城市 → 切换"加密消息" → 选择目标城市 → 查看路由
8. 应该显示路径信息
```

### 场景 2：错误处理测试
```
1. 上传 test_invalid_cities.csv
2. 观察页面错误提示（应该明确指出无法匹配的城市名）
3. 查看浏览器控制台的详细日志
4. 确认后端 /topology/status 的 edges 数量是否减少（无效边被过滤）
```

### 场景 3：不连通测试
```
1. 上传 test_disconnected.csv
2. 在"城市通讯"中尝试查询跨越不同分量的路由
3. 应该显示 "无法获取路由信息: 未找到路径"
4. 查询同分量内的城市（如 北京 -> 上海）应该成功
```

### 场景 4：分步上传测试
```
1. 上传 test_cities_pure.csv（仅城市）
2. 验证页面显示城市已加载
3. 再上传 test_edges_only.csv（仅边）
4. 验证拓扑是否正确合并
```

---

## 📝 CSV 格式规范

### 混合格式（推荐）
```csv
name,lng,lat
北京,116.4074,39.9042
上海,121.4737,31.2304
u,v,w
北京,上海,8
上海,北京,6
```

### 仅城市表
```csv
name,lng,lat
北京,116.4074,39.9042
上海,121.4737,31.2304
```

### 仅边表（城市名）
```csv
u,v,w
北京,上海,8
```

### 仅边表（索引）
```csv
u,v,w
1,2,8
```

---

## 🐛 调试技巧

1. **检查拓扑加载状态**
   ```
   打开浏览器 F12 → 控制台
   输入: fetch('http://localhost:8000/topology/status').then(r => r.json()).then(console.log)
   ```

2. **查看前端解析日志**
   ```
   打开浏览器控制台，搜索关键字：
   - "[MapOverlay]" - 地图页相关日志
   - "[CityCommunication]" - 通讯页相关日志
   - "无法匹配的城市名" - 边表解析错误
   ```

3. **查看后端路由计算结果**
   ```
   直接访问: http://localhost:8000/route?from_city=北京&to_city=成都
   （若路径版本失败，会自动回退到查询参数版本）
   ```

---

## 📋 快速检查清单

上传每个测试文件后，请验证：

- [ ] 页面是否正确识别城市数和边数
- [ ] 是否有合理的错误提示（若有错误）
- [ ] `/topology/status` 返回的数据是否符合预期
- [ ] 在"城市通讯"中是否能正确查询路由
- [ ] 浏览器控制台是否有有用的日志

---

## 💡 建议测试顺序

1. **第一次**：`test_basic_5cities.csv` - 验证基本功能
2. **第二次**：`test_invalid_cities.csv` - 验证错误处理
3. **第三次**：`test_disconnected.csv` - 验证边界情况
4. **第四次**：`test_medium_10cities.csv` - 验证中等规模
5. **第五次**：`test_indexed_edges.csv` - 验证索引支持

---

**生成时间**：2025-10-21  
**版本**：1.0
